{
    "contents" : "library(rvest)\n#loobime veebist andmed\ntulem=c()\nfor (i in 1:175) { #tuleb käsitsi vaadata, kas ehk on juurde tulnud\n  url=paste0(\"http://register.fin.ee/register/index.php?&asuttyyp=&regname=&tunnus=aruanded&regkoodfrom=&regkoodto=&aadr=&korgkood=&action=searchnow&out=&slimit=3000&report=72&page=\",\n  i)\n  html_source =url\n  page = read_html(html_source)\n  tekst=page %>% \n    html_nodes(\".table_system td\") %>%\n    html_text()\n  tulem=c(tulem, tekst)\n  tekst=c()#järgmiseks loobiks nulli ära\n}\n\n#puhastame sodi välja\ntulem=gsub(\"\\n\", \"\", tulem)\neemalda=c(\"Asutuse registrikood\", \"Asutuse tĆ¤isnimi\", \"Maakond, linn/vald, kĆ¼la\",\n          \"TĆ¤nav/maja\", \"Arhiv. kp\", \"LĆµp.akt.nimi\", \"LĆµpet. nr\",\n          \"LĆµpetamise akti kuupĆ¤ev\", \"LĆµpet.kp\", \"Arhiivis\", \"E-mail\")\ntulempuhas=tulem[!tulem %in% eemalda]\ntulempuhas=gsub(\"Ā\", \"\", tulempuhas)\nlibrary(stringr)\ntulempuhas=str_trim(tulempuhas, side = c(\"both\"))\n\n#teeme dataframe'i andmetest\nrkoarr=data.frame(NULL)\n#loobime väärtused dataframe\nfor (i in 1:(length(tulempuhas)/11)) {\n  for (j in 1:11) {\n    rkoarr[i, j]=tulempuhas[(i-1)*11+j]\n  }\n}\n#anname veergudele nimed\nnames(rkoarr)=c(\"Asutuse registrikood\", \"Asutuse täisnimi\", \"Maakond, linn/vald, küla\",\n                \"Tänav/maja\", \"Arhiv. kp\", \"Lõp.akt.nimi\", \"Lõpet. nr\",\n                \"Lõpetamise akti kuupäev\", \"Lõpet.kp\", \"Arhiivis\", \"E-mail\")\n#täpitähed korrektseks\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ć¼\", \"ü\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ćµ\", \"õ\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ć¤\", \"ä\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ć¶\", \"ö\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ć„\", \"Ä\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ć\", \"Ü\", y)))\nrkoarr=as.data.frame(lapply(rkoarr, function(y) gsub(\"Ü•\", \"Õ\", y)))\n\n#salvestame\nwrite.table(rkoarr, \"rkoarr.csv\", row.names = F, sep=\";\")\n\n######Iga asutuse andmete juurde kraapimine\n\n#aadress tab\nrkoarr2=rkoarr\nrkoarr2$asut_liik=NA\nrkoarr2$maakond=NA\nrkoarr2$postikood=NA\nrkoarr2$telefon=NA\nrkoarr2$faks=NA\nrkoarr2$tegevuala_kood=NA\nrkoarr2$tegevusala=NA\n\ntekst=c()\nfor (i in 1:nrow(rkoarr)) { #tuleb käsitsi vaadata, kas ehk on juurde tulnud\n  kood=rkoarr$`Asutuse registrikood`[i]\n  url=paste0(\"http://register.fin.ee/register/viewasutus.php?regkood=\", kood,\n             \"&strip=aadress\")\n  html_source =url\n  page = read_html(html_source)\n  tekst=page %>% \n    html_nodes(\".table_system_viewfield\") %>%\n    html_text()\n  \n  rkoarr2$asut_liik[i]=tekst[3]\n  rkoarr2$maakond[i]=tekst[7]\n  rkoarr2$postikood[i]=tekst[10]\n  rkoarr2$telefon[i]=tekst[11]\n  rkoarr2$faks[i]=tekst[12]\n  rkoarr2$tegevuala_kood[i]=tekst[14]\n  rkoarr2$tegevusala[i]=tekst[15]\n  tekst=c()#uueks loobiks nulli\n}\n\n#moodustamine/register tab\nrkoarr2$Moodust_akti_nr=NA\nrkoarr2$Moodust_akti_kuupäev=NA\nrkoarr2$Asutamise_kuupäev=NA\nrkoarr2$Põhimääruse_akti_nr=NA\nrkoarr2$Põhimääruse_kinnitamise_kuupäev=NA\nrkoarr2$Kande_kuupäev=NA\nrkoarr2$Ettevõtte_registri_kood=NA\nrkoarr2$Kõrgemalseisva_asutuse_number=NA\n\ntekst=c()\nfor (i in 1:nrow(rkoarr)) { #tuleb käsitsi vaadata, kas ehk on juurde tulnud\n  kood=rkoarr$`Asutuse registrikood`[i]\n  url=paste0(\"http://register.fin.ee/register/viewasutus.php?regkood=\", kood,\n             \"&strip=register\")\n  html_source =url\n  page = read_html(html_source)\n  tekst=page %>% \n    html_nodes(\".table_system_viewfield\") %>%\n    html_text()\n  \n  rkoarr2$Moodust_akti_nr[i]=tekst[4]\n  rkoarr2$Moodust_akti_kuupäev[i]=tekst[5]\n  rkoarr2$Asutamise_kuupäev[i]=tekst[6]\n  rkoarr2$Põhimääruse_akti_nr[i]=tekst[7]\n  rkoarr2$Põhimääruse_kinnitamise_kuupäev[i]=tekst[8]\n  rkoarr2$Kande_kuupäev[i]=tekst[9]\n  rkoarr2$Ettevõtte_registri_kood[i]=tekst[10]\n  rkoarr2$Kõrgemalseisva_asutuse_number[i]=tekst[11]\n  tekst=c()#uueks loobiks nulli\n}\n\n##moodustamise aktid ja põhimäärused\nrkoarr2$Moodustamisakt=NA\nrkoarr2$Põhimääruse_akt=NA\n\ntekst=c()\nfor (i in 1:nrow(rkoarr)) { #tuleb käsitsi vaadata, kas ehk on juurde tulnud\n  kood=rkoarr$`Asutuse registrikood`[i]\n  url=paste0(\"http://register.fin.ee/register/viewasutus.php?regkood=\", kood,\n             \"&strip=register\")\n  html_source =url\n  page = read_html(html_source)\n  tekst=page %>% \n    html_nodes(\"td+ td .table_system_fieldset td\") %>%\n    html_text()\n  \n  rkoarr2$Moodustamisakt[i]=tekst[2]\n  rkoarr2$Põhimääruse_akt[i]=tekst[4]\n  tekst=c()#uueks loobiks nulli\n}\n\n#tegevusala tab\nrkoarr2$Tegevusala_kirjeldus=NA\n\ntekst=c()\nfor (i in 1:nrow(rkoarr)) { #tuleb käsitsi vaadata, kas ehk on juurde tulnud\n  kood=rkoarr$`Asutuse registrikood`[i]\n  url=paste0(\"http://register.fin.ee/register/viewasutus.php?regkood=\", kood,\n             \"&strip=tegevusala\")\n  html_source =url\n  page = read_html(html_source)\n  tekst=page %>% \n    html_nodes(\"li\") %>%\n    html_text()\n  \n  rkoarr2$Tegevusala_kirjeldus[i]=tekst[1]\n  tekst=c()#uueks loobiks nulli\n}\n\nhtml_source =\"http://register.fin.ee/register/viewasutus.php?regkood=70000740&strip=tegevusala\"\npage = read_html(html_source)\ntegevusala=page %>% \n  html_nodes(\"li\") %>%\n  html_text()\ntegevusala\n\n",
    "created" : 1461765588566.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2476157762",
    "id" : "97514D2A",
    "lastKnownWriteTime" : 1461871198,
    "path" : "~/R/RKOARR_scraping/rkoarr_scraping.R",
    "project_path" : "rkoarr_scraping.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}